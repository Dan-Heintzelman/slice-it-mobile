<ion-view title="Bill">
    <ion-content padding="true" ng-controller="BillCtrl" class="has-header">
        <ion-refresher
            pulling-text="Pull to Refresh your Bill"
            on-refresh="doRefresh(bill.id)">
        </ion-refresher>
        <header>
            <h3>Primary Slicer: {{bill.primary_customer_name}}</h3>
            <h4><b>{{bill.merchant_name}}</b></h4>
            <h5>Table number {{bill.seating_id}}</h5>
        </header>
        <ion-list ng-controller="PopupCtrl">
            <ul class= "list">
                <li class="item item-button-right" ng-repeat="item in bill.item_array" on-tap="{{bill.paid=true}}||transactionsPopup(item.id,item.item_description,bill.transaction_array)">
                <button class="button button-positive"><strong>{{item.assigned_to.charAt(0).toUpperCase()}}</strong></button>
                {{item.item_description}}<br>
                Base Price + Tax + Tip: <strong>{{item.price*(1+data.tip/100) | currency}}</strong>
                </li>
            </ul>
        </ion-list>
        <div class="total">
            <h3>Total: {{((bill.total/100)*(1+data.tip/100))  | currency}}</h3>
            <h4>Tip: {{data.tip}}%</h4>
        </div>
        <div ng-hide="{{bill.paid=true}}">
            <p>Adjust Tip:</p>
            <div class="item range">
            <i>$</i>
            <input type="range" name="tip" min="0" max="50" value="data.tip" ng-model = "data.tip">
            <i>$$$</i>
            </div>
        </div>
        <ion-list ng-controller="ListCtrl" show-delete="shouldShowDelete" show-reorder="shouldShowReorder" can-swipe="listCanSwipe">

            <ion-item ng-repeat="transaction in bill.transaction_array" class="item item-icon-right item-remove-animate">
                <h3>{{transaction[0]}}</h3><h4>Total Paid: {{transaction[1]/100 | currency}} Total Owed: {{(transaction[3]*(1+data.tip/100))-(transaction[1]/100) | currency}}</h4>
                <h4 ng-show="{{transaction[4]==currentUserID}}">Swipe to Settle Your Bill!</h4>
                <i class="icon ion-ios-arrow-right"></i>
                <ion-option-button class="button-positive" ng-click="edit(transaction)">Edit</ion-option-button>
                <ion-option-button class="button-assertive" ng-click="deleteTrans(bill.id, transaction[2])" ng-show="{{transaction[4]!=currentUserID}}" ng-hide="{{bill.paid}}">Delete</ion-option-button>
                <ion-option-button class="button button-balanced" ng-controller="PopupCtrl" ng-click="chargePopup(bill.id,{{(transaction[3] - transaction[1])}},transaction[2])" ng-show="{{transaction[4]==currentUserID}}" ng-hide="{{bill.paid=true}}">Settle Your Bill</button>
            </ion-item>

        </ion-list>
        <button class="button button-positive  button-block" ng-controller="PopupCtrl" ng-click="showPopup(bill.id)" ng-hide="{{bill.paid=true}}">Add another friend to the bill</button>
    </ion-content>
</ion-view>
